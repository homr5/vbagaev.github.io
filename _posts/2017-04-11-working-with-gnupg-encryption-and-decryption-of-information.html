---
layout: post
title: Работа с GnuPG. Шифрование и расшифровывание информации.
tags: Шифрование,&nbsp;Linux
excerpt_separator: <!--more-->
---

                                <p>GnuPG — это программа и свободная библиотека для шифрование информации и создания электронных цифровых подписей. Она была разработана как альтернатива PGP, другой библиотеки шифрования, но уже не свободной.</p>
                                <p>GnuPG есть почти на всех ОС, будь то Windows, Linux или другие Unix-подобные операционные системы. Часто библиотека GnuPG ,бывает интегрирована в клиенты электронной почты, например Mutt, The Bat! и др.</p>
                                <!--more-->
                                <p>Для пользователей Windows существует возможность установки пакета программ Gpg4win, который включает с себя: саму GnuPG, менеджер сертификатов Kleopatra, а также полноценную почтовую программу Claws Mail.</p>
                                <p>Стоит упомянуть также, что существуют плагины для мессенджеров мгновенных сообщений и большинства популярных браузеров.</p>
                                <p>Принцип работы GnuPG основан на ассиметричном шифровании. Каждый пользователь программы генерирует пару ключей (открытый и закрытый). Открытыми ключами пользователи обмениваются друг с другом любыми способами, в том числе с помощью серверов ключей. Также GnuPG позволяет добавлять криптографическую цифровую подпись к сообщению, при этом целостность и отправитель сообщения могут быть проверены. Закрытый ключ хранится у владельца в запароленном виде. Этот ключ используется для подписывания данных и расшифровывания зашифрованных файлов. Публичный же ключ используется для проверки подписи и шифрования данных.</p>
                                <p>Таким образом, если вы хотите кому-то отправить зашифрованный текст, который получатель сможет расшифровать, вы берёте публичный ключ этого пользователя, шифруете этим ключом данные, отправляете. Получатель берёт приватный ключ и расшифровывает сообщение.</p>
                                <p>Также если необходимо подписать какое-либо сообщение, вы берёте свой приватный ключ, создаете цифровую подпись сообщения и отправляете получателю. Получатель берёт ваш публичный ключ, текст и подпись, и удостоверяется что сообщение не изменено. Для шифрования использует такие алгоритмы как RSA, CAST5, 3DES, AES, Blowfish и Twofish.</p>

                                <h3>Установка продукта и создание пары ключей</h3>
                                <p>Установить программу можно скачав ее с официального <a href="https://www.gnupg.org/download/">сайта</a>, или из репозиториев вашего дистрибутива. Чтобы сгенерировать пару ключей используйте введите команду в терминал.</p>
                                <pre><code class="bash">gpg --gen-key</code></pre>
                                <p>Или если версия программы 2.0 и выше</p>
                                <pre><code class="bash">gpg --full-gen-key</code></pre>
                                <p>Программа потребует указать тип требуемого ключа, выберите желаемый, либо нажмите Enter, чтобы выбрать RSA по умолчанию.</p>
                                <p>Введите желаемый размер ключа. Рекомендуем максимальный размер ключа 4096. Введите временной интервал, в течение которого ключ должен быть действительным. Нажмите Enter для выбора по умолчанию. Проверьте введенные данные и введите свои идентификационные данные и пароль для защиты закрытого ключа.</p>
                                <p>Для отображения списка пар ключей используйте команду:</p>
                                <pre><code class="bash">gpg --list-secret-keys --keyid-format LONG</code></pre>
                                <p>вывод</p>
                                <pre><code  class="bash">/home/vbagaev//.gnupg/pubring.kbx
---------------------------------
sec   rsa2048/68FDE2D277BED407 2017-01-20 [SC]
uid               [  абсолютно ] Valeriy Bagaev (front-end developer) &lt;valery.bagaev84@gmail.com&gt;
ssb   rsa2048/8E033C3CF527A4CB 2017-01-20 [E]
</code></pre>
                                <p>В приведенном выше сниппете 68FDE2D277BED407 - это идентификатор пары ключей, key ID. Во всех перечисленных командах вместо key ID можно использовать и имя пользователя и его e-mail.</p>
                                <p>Итак создав ключевую пару мы может использовать ее для шифрование почты или файлов.</p>
                                <h3>Использование почтовой программы Thunderbird совместно с GnuPG</h3>
                                <p>Для того чтобы можно было спокойно принимать и отправлять почту в Mozilla Thunderbird необходимо установить расширение Enigmail, которое позволяет работать с шифровальными возможностями GnuPG прямо из Thunderbird.</p>
                                <p>Установив расширение настраиваем его, выбрав стандартную конфигуацию. Перед тем, как отправлять друг другу зашифрованные письма, необходимо обменяться открытыми ключами. Следует также удостовериться, что каждый такой ключ действительно принадлежит его владельцу.</p>
                                <p>Чтобы отправить публичный ключ адресату выполните следующие действия. В окне создания письма выберите меню Enigmail &gt; Присоединить мой открытый ключ. Выберите ключ и отправьте письмо. Противоположный адресат также должен прислать вам свой открытый ключ.</p>
                                <p>Для импортирования присланного Вам ключа необходимо щелкнуть правой кнопкой на вложении и выбрать пункт Импорт ключа OpenPGP.</p>
                                <p>Теперь нужно удостовериться, что полученный вами ключ действительно принадлежит его владельцу. Проверив ключ, вы должны подписать его. Для этого выберите Enigmail &gt; Менеджер ключей, щелкаем правой кнопкой по присланному ключу и выбираем пункт Подписать ключ. Теперь Вы спокойно можете обмениваться шифрованными письмами со своим собеседником.</p>
                                <p>Отправка зашифрованного письма происходит так, составляем сообщение для адресата, чей открытый ключ у Вас есть. Затем нажимаем на кнопку с замком на панели инструментов, чтобы зашифровать сообщение или на кнопку с карандашом, чтобы только подписать. Если в программе есть есть открытый ключ адресата, то появится сообщение — This message will be signed encrypted.</p>
                                <p>Чтобы расшифровать сообщение, достаточно просто открыть его и ввести пароль от вашего секретного ключа.</p>
                                <h3>Использование утилиты GnuPG в командной строке</h3>
                                <p>GnuPG создает в домашней папке пользователя скрытую директорию .gnupg. В ней содержатся все открытые и закрытые ключи, а также файл конфигурации gpg.conf. Бывает полезно в нем указать закрытый ключ по умолчанию. Найдите директивы default-key и default-recipient-self , раскомментируйте их и укажите сигнатуру вашей пары ключей. Теперь утилита по умолчанию будет использовать именно их.</p>
                                <p>Шифрование файлов:</p>
                                <pre><code  class="bash">gpg -e -o somefile.gpg somefile</code></pre>
                                <p>Чтобы зашифровать не дефолтным ключом:</p>
                                <pre><code  class="bash">gpg -e -r key ID somefile</code></pre>
                                <p>Расшифровывание файла:</p>
                                <pre><code  class="bash">gpg -d -o somefile somefile.gpg</code></pre>
                                <p>Чтобы подписать файл необходимо с помощью параметра -u указать какой ключ использовать:</p>
                                <pre><code  class="bash">gpg -u key ID --detach-sign somefile</code></pre>
                                <p>Будет подписан файл и создан файл подписи somefile.sig. Если хотите зашифровать файл и одновременно подписать его следует использовать команду:</p>
                                <pre><code  class="bash">gpg -u key ID -s somefile</code></pre>
                                <p>Для проверки подписи и расшифровывания файла используйте команду:</p>
                                <pre><code  class="bash">gpg --output somefile --decrypt somefile.gpg</code></pre>
                                <p>Или же команду, если файл подписи расположен рядом на диске.:</p>
                                <pre><code  class="bash">gpg --verify somefile.sig</code></pre>
                                <h3>Другие полезные команды</h3>
                                <p>Чтобы экспортировать публичный ключ используйте команду:</p>
                                <pre><code  class="bash">gpg --armor --export key ID</code></pre>
                                <p>Для экспорта в файл можно использовать с параметром —output.</p>
                                <pre><code  class="bash">gpg --armor --output somefile.asc --export key ID</code></pre>
                                <p>Для экспорта закрытого ключа:</p>
                                <pre><code  class="bash">gpg --armor --output somefile.key --export-secret-keys key ID</code></pre>
                                <p>Импортирование как закрытых, так и открытых ключей осуществятся командой, где somefile — файл ключа.</p>
                                <pre><code  class="bash">gpg --import  somefile</code></pre>
                                <p>Также можно прямо из командной строки зарегистрировать ключ на сервере ключей (например pgp.mit.edu ).</p>
                                <pre><code  class="bash">gpg  --keyserver pgp.mit.edu —send-keys key ID</code></pre>
                                <p>На этом все. Надеюсь эта запись была вам полезна.</p>
                                <h3>Дополнительные ссылки</h3>
                                <ol>
                                    <li class="blog-item__content-li">Официальный сайт <a href="https://www.gnupg.org/">GnuPG</a></li>
                                    <li class="blog-item__content-li"><a href="https://ru.wikipedia.org/wiki/PGP">PGP</a></li>
                                    <li class="blog-item__content-li"><a href="https://wiki.archlinux.org/index.php/GnuPG_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)">Wiki по Gnupg</a></li>
                                </ol>
